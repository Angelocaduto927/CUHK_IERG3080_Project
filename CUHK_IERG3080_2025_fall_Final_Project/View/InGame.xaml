<UserControl x:Class="CUHK_IERG3080_2025_fall_Final_Project.View.InGame"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:vm="clr-namespace:CUHK_IERG3080_2025_fall_Final_Project.ViewModel"
             mc:Ignorable="d"
             d:DesignHeight="900" d:DesignWidth="1600"
             Focusable="True">

    <UserControl.Resources>
        <vm:BoolToVisibilityConverter x:Key="BoolToVis"/>
    </UserControl.Resources>

    <Viewbox Stretch="UniformToFill">
        <Grid Width="1600" Height="900">
        <Grid.Background>
            <ImageBrush ImageSource="/Assets/Image/InGameBG.png" Stretch="UniformToFill"/>
        </Grid.Background>

        <Grid VerticalAlignment="Center">
            <Grid.RowDefinitions>
                <RowDefinition Height="{Binding P1Coordinate}"/>
                <RowDefinition Height="{Binding P2Coordinate}"/>
            </Grid.RowDefinitions>

                <Border Grid.Row="0" Background="#66000000" BorderBrush="#FF6B4E" BorderThickness="0,2" Height="{Binding BandWidth}" 
                        Margin="0,20,0,10" VerticalAlignment="Center">
                    <Canvas ClipToBounds="True" Width="1600">
                    <Rectangle Width="4" Height="{Binding RelativeSource={RelativeSource AncestorType=Canvas}, Path=ActualHeight}"
                                Fill="#FF6B4E" Canvas.Left="270"/>
                        <TextBlock Text="Player 1" FontSize="20" FontWeight="Bold" Canvas.Left="90" Canvas.Top="10" Foreground="#FF6B4E">
                        </TextBlock>
                    <TextBlock Text="{Binding P1HitText}" FontSize="20" FontWeight="Bold" Width="70" TextAlignment="Center"
                               Canvas.Left="235" Canvas.Top="10" Visibility="{Binding P1HitVisible, Converter={StaticResource BoolToVis}}"
                               Foreground="{Binding P1HitBrush}">
                        <TextBlock.Effect>
                                <DropShadowEffect Color="#000000" BlurRadius="6" ShadowDepth="0"/>
                            </TextBlock.Effect>
                    </TextBlock>

                    <Ellipse Width="60" Height="60" Stroke="{Binding P1EllipseStroke}" StrokeThickness="6" Fill="{Binding P1EllipseFill}"
                                Canvas.Left="242" Canvas.Top="45">
                        <Ellipse.Effect>
                            <DropShadowEffect Color="#FF6B4E" BlurRadius="20" ShadowDepth="0"/>
                        </Ellipse.Effect>
                    </Ellipse>

                    <TextBlock Text="{Binding P1Score}" FontSize="36" FontWeight="Bold" FontFamily="Segoe UI" VerticalAlignment="Top"
                                Foreground="#FFD700" Canvas.Left="50" Canvas.Top="45"/>

                    <ItemsControl ItemsSource="{Binding Player1Notes}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <Canvas/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemContainerStyle>
                            <Style>
                                <Setter Property="Canvas.Left" Value="{Binding X}"/>
                                <Setter Property="Canvas.Top" Value="{Binding Y}"/>
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Width="60" Height="60">
                                    <Ellipse Fill="{Binding Fill}" />
                                    <Ellipse Stroke="{Binding Border}" StrokeThickness="4"/>
                                    <TextBlock Text="{Binding Icon}" FontSize="40" FontWeight="Bold" Foreground="#C0C0C0"
                                                HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Canvas>
            </Border>

            <Border Grid.Row="1" Background="#66000000" BorderBrush="#4E9AFF" BorderThickness="0,2" Height="{Binding BandWidth}" 
                        Margin="0,10,0,20" VerticalAlignment="Center"
                        Visibility="{Binding IsMultiplayer, Converter={StaticResource BoolToVis}}">
                <Canvas ClipToBounds="True" Width="1600">
                    <Rectangle Width="4" Height="{Binding RelativeSource={RelativeSource AncestorType=Canvas}, Path=ActualHeight}"
                              Fill="#4E9AFF" Canvas.Left="270"/>
                        <TextBlock Text="Player 2" FontSize="20" FontWeight="Bold" Canvas.Left="90" Canvas.Top="10" Foreground="#4E9AFF">
                        </TextBlock>
                    <TextBlock Text="{Binding P2HitText}" FontSize="20" FontWeight="Bold" Width="70" TextAlignment="Center"
                               Canvas.Left="235" Canvas.Top="10" Visibility="{Binding P2HitVisible, Converter={StaticResource BoolToVis}}"
                               Foreground="{Binding P2HitBrush}">
                        <TextBlock.Effect>
                            <DropShadowEffect Color="#000000" BlurRadius="6" ShadowDepth="0"/>
                        </TextBlock.Effect>
                    </TextBlock>

                    <Ellipse Width="60" Height="60" Stroke="{Binding P2EllipseStroke}" StrokeThickness="6" Fill="{Binding P2EllipseFill}"
                            Canvas.Left="242" Canvas.Top="45">
                        <Ellipse.Effect>
                            <DropShadowEffect Color="#4E9AFF" BlurRadius="20" ShadowDepth="0"/>
                        </Ellipse.Effect>
                    </Ellipse>

                    <TextBlock Text="{Binding P2Score}" FontSize="36" FontWeight="Bold" FontFamily="Segoe UI" VerticalAlignment="Top"
                              Foreground="#FFD700" Canvas.Left="50" Canvas.Top="45"/>

                    <ItemsControl ItemsSource="{Binding Player2Notes}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <Canvas/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemContainerStyle>
                            <Style>
                                <Setter Property="Canvas.Left" Value="{Binding X}"/>
                                <Setter Property="Canvas.Top" Value="{Binding Y}"/>
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Width="60" Height="60">
                                    <Ellipse Fill="{Binding Fill}" />
                                    <Ellipse Stroke="{Binding Border}" StrokeThickness="4"/>
                                    <TextBlock Text="{Binding Icon}" FontSize="40" FontWeight="Bold" Foreground="#C0C0C0"
                                              HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Canvas>
            </Border>
        </Grid>
        </Grid>
    </Viewbox> 
</UserControl>